# M4_CAN_Feather_Carrier_v2

## Board Layout
![alt text](https://github.com/2468shrm/M4_CAN_Feather_Carrier_v2/blob/main/Images/Board%20Layout.png?raw=true)

## Introduction
The carrier board is an adaptor to make using the Adafruit M4 CAN Express
Feather board more useful in FRC applications. This board was designed by mentors
of FRC2468/2687/2689. An initial version was done early in 2022, fabricated at JLCPCB
and tested to a limited degree. During the testing some weaknesses were identified and
initial design decisions questioned. Hence V2. Neither has received any actual FRC
use (it was not used by any of our teams during the 2022 competition season). However
a small number of these boards will be fabricated after the kickoff to the 2023 season.

This is the board as referenced in the [frc_can](https://github.com/2468shrm/frc_can)
project's CANCarrierBoard module (in
[can_carrier_board.py](https://github.com/2468shrm/frc_can/blob/main/can_carrier_board.py)).

## Board Description
The carrier board provides the following:
- Power interface (J1)
  - Power comes from a 12V supply through the provided 2-input screw terminal
  - The power supply contains a diode capacitor circuit to reduce the effects of FRC robot brownouts
- CAN interface
  - On the feather board
  - Note the feather board comes with termination included and active, so you must cut the termination trace jumper
- Analog I/O (AIO)
  - 4 analog inputs
  - Buffered with a unity gain opamp
  - Proded by 3-pin interface (similar to AIO on RoboRIO)
    - Pin 1: input analog signal
    - Pin 2: 3.3V supply
    - Pin 3: Ground
  - 3.3V input, max
- Digital I/O (DIO)
  - 4 digital inputs
  - Buffered with a level shifter
  - Selectable sensor voltage (VDD): 3.3V or 5V (all inputs share)
    - VDD selected by a jumper (J5)
    - 1-2 selects 3.3V
    - 2-3 selects 5V
  - Proded by 3-pin interface (similar to AIO on RoboRIO)
    - Pin 1: input analog signal
    - Pin 2: VDD supply
    - Pin 3: Ground
- Additional sensor power (J4)
	- A 2x4 header provided to provide additional VDD power to sensors
    - Intended for Adafruit beam break emitters or other multi-part sensors using an emitter and receiver pair where the receiver connects to DIO and emitter connects to the additional sensor power
- STEMMA QT/QWIIC (X1, X2, X3, X4)
  - 4 interfaces provided
- Neopixel (J2)
  - A Neopixel interface provided via a 3-input screw terminal
  - Intended to allow sensor to provide state of the sensor both over CAN and visually (i.e. sensor could be disconnected while still being useful)

## Power Interface
The initial version of this board was designed at the height of the pandemic's supply
chain shortage and so while I wanted to provide a 3A 5V supply (from 12V source) finding
the components was problematic at best. So I found a cheap, simple power supply module I
could acquire on Amazon. So I used it.

## Disclaimer
While I've tested a prior version of this board, it is to be considered alpha and subject
to bugs and errors. Use at your own risk. However the Gerbers are provided should you
want to fabricate your own.

## Updating the Programming
A switch (SW1, beside the power module) is provided to isolate the 5V generated by the
Weewooday module (U1) and the boost regulator on the Feather board. When programming a USB-C
cable is connected and the 5V is supplied on the feather board from this path. This would
lead to a contended supply. So, before programming change SW1 to open and plug in the board
to a host. Disconnect and change SW1 to closed to return to robot-supplied power.

# 3D Views of the Board
## Top
![alt text](https://github.com/2468shrm/M4_CAN_Feather_Carrier_v2/blob/main/Images/M4_CAN_Feather_Carrier%20Top.png?raw=true)

## Iso Front
![alt text](https://github.com/2468shrm/M4_CAN_Feather_Carrier_v2/blob/main/Images/M4_CAN_Feather_Carrier%20Corner%202%20Iso.png?raw=true)

## Iso Back
![alt text](https://github.com/2468shrm/M4_CAN_Feather_Carrier_v2/blob/main/Images/M4_CAN_Feather_Carrier%20Corner%20Iso.png?raw=true)

